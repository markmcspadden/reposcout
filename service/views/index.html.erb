<html>
  <head>
    <!--
      <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    -->
    <script src="/js/jquery-1.11.0.min.js"></script>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
      body {
        color: #333;
        font-family: "Helvetica Neue", Helvetica;
        font-size: 16px;
        margin: 0;
      }
      #main-head {
        /*background: #F3F3F3;*/
        background: #fff;
        border-bottom: 1px solid #e5e5e5;
        padding: 10px;
      }
      #main-head h1 {
        font-size: 1.2em;
        margin: 0;
        padding: 0;

      }
      .main {
        margin: 0 auto;
        width: 960px;
      }
      #main-content {
        background: #ffffff;
      }
      #main-content form {
        margin: 20px 0;
      }
      
      #main-content form input[type=text] {
        font-size: 2.75em;
        width: 550px;
      }
      #main-content form button {
        font-size: 3.0em;
        width: 100px;
        /*border: 1px solid #eee;*/
        border: 0;
        background: #fff;
        padding: 0;
        height: 53px;
        color: #a9a9a9;
      }
      #main-content form button:hover {
        color: inherit;
      }

      #lead {
        /*background: #fcfcfc;*/
        background: #fff;
        border-bottom: 1px solid #e5e5e5;
        font-size: 0.9em;
        padding: 10px 0;
      }
      #lead aside {
        float: right;
        /*background: #ffffff;*/
        background: #f7f7f7;
        border: 1px solid #dddddd;
        height: 300px;
        padding: 5px;
        width: 200px;
      }
      #lead aside p {
        margin-top: 0;
      }

      #results {
        width: 920px;
      }

      #results h3 {
        margin-bottom: 0;
      }

      #results #health_result {
        font-size: 3.0em;
      }
      #results #health_result p {
        font-size: 0.5em;
        margin: 0;
      }
      #health_result.great {
        /*color: gold;*/
        /*color: LightSkyBlue;*/
        color: purple;
      }
      #health_result.good {
        color: green;
      }
      #health_result.meh {
        color: yellow;
      }
      #health_result.sad {
        color: red;
      }

      #details {
        overflow: auto;
      }
      #details a {
        color: #A9A9A9;
      }
      #details a.current {
        font-weight: bold;
        text-decoration: none;
      }

      #details ul {
        list-style-type: none;
        margin: 20px 0 0 0;
        padding: 0;

      }
      #details li {
        float: left;
        font-size: 0.9em;
        margin-right: 20px;
        width: 160px;
      }
      #details li p {
        font-size: 2.75em;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <header id="main-head">
      <section class="main">
        <h1>RepoScout</h1>
      </section>
    </header>
    <section id="main-content">
      <section id="lead">
        <section class="main">
          <aside>
            <p>
              Download the Chrome Extenstion
            </p>
            <hr/>
            <p>Recently Searched</p>
            list here
          </aside>
          <p>
            RepoScout helps you quickly understand the state of any repository hosted on GitHub through a ScoutScore.
            Use the form below or download the Chrome Extension to view repo state anytime you are looking at a repo in Chrome.
          </p>
          <p>
            Everything you find here is Open Source, available on GitHub, and currently has a ScoutScore of: TK
          </p>
          <p>
            RepoScout was created as part of the GitHub Data Challenge 2014.
            <a href="#" id="learn-more">
              Learn more about the RepoScout project
            </a>  
          </p>
          <section id="project-more" style="display: none;">
            <p>
              Details about the project
            </p>
            <a href="#" id="learn-less">
              Learn less about the RepoScout project
            </a>
          </section>
        </section>
      </section>
      <section class="main">
        <form action="#">
          <input id="repo" type="text" placeholder="owner/repo-name"/>
          
          <!-- <input type="submit" value="Search" /> -->
          <button><i class="fa fa-search"></i></button>
        </form>

        <section id="results">
          <h3>The ScoutScore for <span id="search-repo-label">fake/fake</span></h3>
          <div id="health_result" class="Great">
            <span id="score_in_words">Great</span>
            <p>
              <i class="fa fa-flag"></i>
              <span id="score_phrase">All Clear. Use at will.</span>
            </p>
          </div>          
          <div id="details">
            <h3>Current ScoutScore Details</h3>
            <a href="#" id="last_7_link" class="current">Last 7 Days</a>
            &nbsp;|&nbsp;
            <a href="#" id="last_30_link">Last 30 Days</a>
            <ul id="last_7_stats">
              <li>
                <p>7</p>
                Watch Events
              </li>
              <li>
                <p>14</p>
                Forks Events
              </li>
              <li>
                <p>21</p>
                Issues Events<br/><small>(Opened/Closed + Comments)</small>
              </li>
              <li>
                <p>31</p>
                Pull Requests Events<br/><small>(Opened/Closed/Merged + Comments)</small>
              </li>
              <li>
                <p>41</p>
                Push Events
              </li>
            </ul>
            <ul id="last_30_stats" style="display:none;">
              <li>
                <p>7</p>
                Watch Events
              </li>
              <li>
                <p>14</p>
                Forks Events
              </li>
              <li>
                <p>21</p>
                Issues Events <small>(Opened/Closed + Comments)</small>
              </li>
              <li>
                <p>31</p>
                Pull Requests Events <small>(Opened/Closed/Merged + Comments)</small>
              </li>
              <li>
                <p>41</p>
                Push Events
              </li>
            </dl>
          </div>
          <div id="history">
            <h3>ScoutScore History</h3>
            chart thing
          </div>
          <div id="predictions">
            <h3>Predictions</h3>
            <dl>
              <dt>37% percent chance</dt>
              <dd>Repo is still in "Good" standing in 6 months (better than average)</dd>
              <dt>21% percent chance</dt>
              <dd>Repo degrades to "sad" 6 months</dd>
              <dt>12% percent chance</dt>
              <dd>Repo moves up to "great" in the next 6 months</dd>
            </dl>
            <small>Predictions are made based on....something...</small>
          </div>
        </section>
      </section>
    </section>
  </body>

  <script type="text/javascript">
    function fetchHealth() {
      // TODO: Do some validation
      var repo = $('#repo').val();

      $('#repo').blur();

      // Do some spinner stuff

      // Request health
      $.ajax("/" + repo + "/health", {
        dataType: "json",
        success: function(data) {
          console.log(data);
          $('#health_result #score_in_words').html(data["overall_health"]);
          $('#health_result #score_phrase').html(data["overall_health_phrase"]);

          // Flag or Trophy
          var flag_or_trophy = "fa-flag";
          if(data["overall_health"] == "Great") {
            flag_or_trophy = "fa-trophy";
          }
          $('#health_result i').removeClass();
          $('#health_result i').addClass("fa");
          $('#health_result i').addClass(flag_or_trophy);

          $('#health_result').removeClass();
          $('#health_result').addClass(data["overall_health"]);
          $('#search-repo-label').html(repo);

          // Probably need to handlebar this 
          $('#last_7_stats li:nth-of-type(1) p:first').html(data["last_7"]["watch_counts"]);
          $('#last_7_stats li:nth-of-type(2) p:first').html(data["last_7"]["fork_counts"]);
          $('#last_7_stats li:nth-of-type(3) p:first').html(data["last_7"]["issue_counts"]);
          $('#last_7_stats li:nth-of-type(4) p:first').html(data["last_7"]["pr_counts"]);
          $('#last_7_stats li:nth-of-type(5) p:first').html(data["last_7"]["push_counts"]);

          $('#last_30_stats li:nth-of-type(1) p:first').html(data["last_30"]["watch_counts"]);
          $('#last_30_stats li:nth-of-type(2) p:first').html(data["last_30"]["fork_counts"]);
          $('#last_30_stats li:nth-of-type(3) p:first').html(data["last_30"]["issue_counts"]);
          $('#last_30_stats li:nth-of-type(4) p:first').html(data["last_30"]["pr_counts"]);
          $('#last_30_stats li:nth-of-type(5) p:first').html(data["last_30"]["push_counts"]);


          $('#results').show();

          // Update url!
        }
      });
    }

    $(function(){
      $('form').submit(function(e) {
        e.preventDefault();

        fetchHealth();
      });
      $('button').click(function(e) {
        e.preventDefault();

        fetchHealth();
      });

      $('#learn-more').click(function(e) {
        e.preventDefault();
        $('#learn-more').hide();
        $('#project-more').show();
      });

      $('#learn-less').click(function(e) {
        e.preventDefault();
        $('#project-more').hide();
        $('#learn-more').show();
      });

      $('#last_7_link').click(function(e) {
        e.preventDefault();

        $('#last_30_link').removeClass('current');
        $('#last_7_link').addClass('current');
        $('#last_30_stats').hide();
        $('#last_7_stats').show();
      });

      $('#last_30_link').click(function(e) {
        e.preventDefault();

        $('#last_7_link').removeClass('current');
        $('#last_30_link').addClass('current');
        $('#last_7_stats').hide();
        $('#last_30_stats').show();
      });
    });
  </script>
</html>
